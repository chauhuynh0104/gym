<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>5 Bu·ªïi Th√¢n Tr√™n ‚Äî Progression Trainer (Auto-fill Sets & Reps)</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
:root {
  --bg: #ffffff;
  --card: #f7f8fb;
  --accent: #ff7a18;
  --muted: #666;
  --border: #e6e9ef;
  --text: #222;
}

* {
  box-sizing: border-box;
}

body {
  font-family: "Inter", "Segoe UI", Roboto, sans-serif;
  background: var(--bg);
  color: var(--text);
  margin: 0;
  padding: 16px;
}

.app {
  max-width: 1100px;
  margin: 0 auto;
}

header {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  flex-wrap: wrap;
  margin-bottom: 16px;
}

h1 {
  margin: 0;
  font-size: 22px;
  color: var(--text);
}

.small {
  font-size: 14px;
  color: var(--muted);
}

.card {
  background: var(--card);
  border-radius: 14px;
  padding: 18px;
  margin-bottom: 14px;
  border: 1px solid var(--border);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
}

.menu {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.menu button {
  flex: 1 1 auto;
  background: white;
  border: 1px solid var(--border);
  color: #333;
  padding: 10px 14px;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.25s ease;
}

.menu button:hover {
  background: #fff4ec;
}

.menu button.active {
  background: linear-gradient(90deg, var(--accent), #ffb06b);
  color: white;
  border: none;
}

.ex-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 14px;
}

.ex {
  background: white;
  padding: 14px;
  border-radius: 12px;
  border: 1px solid #eef0f6;
  transition: transform 0.2s ease;
}

.ex:hover {
  transform: translateY(-2px);
}

.row {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 8px;
  margin-top: 6px;
}

label {
  font-size: 13px;
  color: #333;
  min-width: 70px;
}

input[type="number"],
select {
  flex: 1 1 60px;
  padding: 8px 10px;
  border-radius: 8px;
  border: 1px solid #d7dbe6;
  background: #fff;
  color: #222;
  font-size: 14px;
}

input[readonly] {
  background: #f4f6fa;
  color: #555;
}

.btn {
  padding: 10px 12px;
  border-radius: 8px;
  border: 1px solid #ccc;
  background: #fff;
  cursor: pointer;
  transition: 0.25s;
}

.btn:hover {
  background: #f4f4f4;
}

.btn.primary {
  background: var(--accent);
  color: white;
  border: none;
}

.btn.primary:hover {
  background: #ff8a35;
}

.suggest {
  margin-top: 10px;
  border-radius: 8px;
  background: #fff7ef;
  color: #663300;
  border: 1px solid #ffdfc4;
  padding: 10px;
  font-size: 14px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  font-size: 14px;
}

th,
td {
  padding: 8px 10px;
  border-bottom: 1px solid #f0f2f8;
  text-align: left;
}

.chart-wrap {
  height: 260px;
  background: white;
  border: 1px solid #eef0f6;
  border-radius: 10px;
  padding: 8px;
  margin-top: 10px;
}

/* === Responsive === */
@media (max-width: 600px) {
  body {
    padding: 12px;
  }

  .row {
    flex-direction: column;
    align-items: stretch;
  }

  .row label {
    text-align: left;
    min-width: auto;
  }

  .btn {
    width: 100%;
  }

  .menu button {
    flex: 1 1 100%;
  }

  .chart-wrap {
    height: 200px;
  }
}

</style>
</head>
<body>
  <div class="app">

    <div class="menu card" id="menuDays">
      <button data-day="1" class="active">Th·ª© 2 ‚Äî PUSH I</button>
      <button data-day="2">Th·ª© 3 ‚Äî PULL I</button>
      <button data-day="3">Th·ª© 4 ‚Äî VAI / NG·ª∞C TR√äN</button>
      <button data-day="4">Th·ª© 5 ‚Äî PULL II</button>
      <button data-day="5">Th·ª© 6 ‚Äî PUSH II</button>
    </div>

    <div id="dayContent" class="card"></div>

    <div class="card">
      <h3>Progression Log & Chart</h3>
      <div class="row">
        <label style="min-width:110px">Ch·ªçn b√†i:</label>
        <select id="selectExercise"></select>
        <button class="btn primary" id="showLog">Hi·ªán log</button>
        <button class="btn" id="clearLog">X√≥a log</button>
      </div>
      <div id="logTableWrap"></div>
      <div class="chart-wrap"><canvas id="progressChart"></canvas></div>
    </div>

    <footer style="margin-top:12px;color:#666;font-size:13px;display:none">
      Thu·∫≠t to√°n: so s√°nh <strong>Volume = Kg √ó Reps √ó Sets</strong> hi·ªán t·∫°i v·ªõi l·∫ßn tr∆∞·ªõc: tƒÉng ‚â•5% = ti·∫øn b·ªô; ¬±5% = stagnant (ƒë·ªÅ ngh·ªã +1rep ho·∫∑c +1set ho·∫∑c +1.25kg); gi·∫£m ‚â•5% = regress (∆∞u ti√™n ph·ª•c h·ªìi).
    </footer>
  </div>

<script>
/* ====== Plan + default sets & reps (the table üî• provided) ====== */
const plan = {
  1: { name:'PUSH I', ex: [
    {name:'Flat Barbell Bench Press', sets:4, reps:8},
    {name:'Incline Barbell Bench Press', sets:4, reps:8},
    {name:'Iso-Lateral Chest Press', sets:3, reps:10},
    {name:'Dumbbell Shoulder Press', sets:3, reps:10},
    {name:'Cable Crossover', sets:3, reps:12},
    {name:'Rope Pushdown', sets:3, reps:10},
    {name:'Overhead Dumbbell Extension', sets:3, reps:12}
  ]},
  2: { name:'PULL I', ex: [
    {name:'Weighted Pull-up', sets:4, reps:8},
    {name:'Seated Cable Row', sets:4, reps:8},
    {name:'T-Bar Row / Machine Row', sets:3, reps:10},
    {name:'Lat Pulldown (wide)', sets:3, reps:10},
    {name:'Dumbbell Shrug', sets:3, reps:15},
    {name:'Barbell Curl', sets:3, reps:8},
    {name:'Incline Dumbbell Curl', sets:3, reps:12}
  ]},
  3: { name:'VAI / NG·ª∞C TR√äN', ex: [
    {name:'Smith Shoulder Press', sets:4, reps:8},
    {name:'Dumbbell Lateral Raise', sets:4, reps:12},
    {name:'Rear Delt Fly Machine', sets:3, reps:12},
    {name:'Incline Bench Press Machine', sets:3, reps:10},
    {name:'Dumbbell Front Raise', sets:3, reps:12},
    {name:'Cable Rope Overhead Extension', sets:3, reps:12},
    {name:'Dips', sets:3, reps:8}
  ]},
  4: { name:'PULL II', ex: [
    {name:'Pull-up (wide grip)', sets:4, reps:8},
    {name:'Iso-Lateral Pulldown', sets:4, reps:10},
    {name:'Seated Row (close grip)', sets:3, reps:10},
    {name:'Face Pull', sets:3, reps:15},
    {name:'Upright Row', sets:3, reps:10},
    {name:'Hammer Curl', sets:3, reps:10},
    {name:'Concentration Curl', sets:3, reps:12}
  ]},
  5: { name:'PUSH II', ex: [
    {name:'Incline Smith Bench Press', sets:4, reps:8},
    {name:'Flat Machine Press', sets:4, reps:10},
    {name:'Dumbbell Fly / Pec Deck', sets:3, reps:12},
    {name:'Arnold Press', sets:3, reps:10},
    {name:'Lateral Raise', sets:3, reps:12},
    {name:'Close Grip Bench Press', sets:3, reps:8},
    {name:'Rope Pushdown Superset Dumbbell Curl', sets:3, reps:12}
  ]}
};

/* ====== State ====== */
const STORAGE_KEY = 'upper_progression_v3';
let state = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');

/* ====== Helpers ====== */
function $(s, ctx=document){ return ctx.querySelector(s); }
function $a(s, ctx=document){ return Array.from((ctx||document).querySelectorAll(s)); }

/* ====== Render day with sets/reps prefilled (readonly) ====== */
const dayContent = $('#dayContent');

function renderDay(day){
  const data = plan[day];
  let html = `<h3 style="margin-top:0">${data.name}</h3><div class="ex-list">`;
  data.ex.forEach((ex, idx)=>{
    const encoded = encodeURIComponent(ex.name);
    html += `
      <div class="ex" data-name="${encoded}">
        <h3>${ex.name}</h3>

      <div class="row">
  <label>Set</label>
  <input type="number" class="inputSets" value="${ex.sets}" ...>
  <label style="min-width:60px">Reps</label>
  <input type="number" class="inputReps" value="${ex.reps}" ...>
  <label style="min-width:60px">Kg</label>
  <input type="number" class="inputKg" ...>
</div>

        <div class="row"style="margin-top:8px;">
          <label>Target reps</label>
          <input type="number" class="inputTarget" value="${ex.reps}" min="1" step="1" style="width:80px">
          <div class="small" style="margin-left:8px">Volume = Kg √ó Reps √ó Sets</div>
        </div>

        <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
          <button class="btn primary btnSuggest">ƒê·ªÅ ngh·ªã</button>
          <button class="btn btnSave">L∆∞u session</button>
          <button class="btn btnCalc">T√≠nh volume</button>
          <div style="margin-left:auto;font-size:13px;color:#333">Volume: <span class="kv curVolume">‚Äî</span></div>
        </div>

        <div class="suggest" style="display:none"></div>
      </div>`;
  });
  html += `</div>`;
  dayContent.innerHTML = html;

  // attach events
  $a('.btnSuggest').forEach(b => b.addEventListener('click', onSuggest));
  $a('.btnSave').forEach(b => b.addEventListener('click', onSaveSession));
  $a('.btnCalc').forEach(b => b.addEventListener('click', onCalcVolume));
  populateExerciseSelect();
  $a('.ex').forEach(ex => updateVolumeDisplay(ex));
  restoreKgValues();
  attachKgAutoSave();
}


/* ====== Auto-save Kg input to localStorage ====== */
function restoreKgValues(){
  $a('.ex').forEach(ex => {
    const exName = decodeURIComponent(ex.dataset.name);
    const key = 'kg:' + exName;
    const savedKg = localStorage.getItem(key);
    if(savedKg !== null){
      const input = ex.querySelector('.inputKg');
      if(input) input.value = savedKg;
    }
  });
}
function attachKgAutoSave(){
  $a('.inputKg').forEach(inp => {
    inp.addEventListener('input', e => {
      const exEl = e.target.closest('.ex');
      if(!exEl) return;
      const exName = decodeURIComponent(exEl.dataset.name);
      const key = 'kg:' + exName;
      localStorage.setItem(key, e.target.value);
    });
  });
}

/* ====== Volume calculation ====== */
function computeVolume(sets, reps, kg){
  const s = Number(sets) || 0;
  const r = Number(reps) || 0;
  const k = Number(kg) || 0;
  return Number((k * r * s).toFixed(2));
}

function updateVolumeDisplay(exEl){
  const sets = exEl.querySelector('.inputSets').value;
  const reps = exEl.querySelector('.inputReps').value;
  const kg = exEl.querySelector('.inputKg').value;
  const vol = computeVolume(sets, reps, kg);
  exEl.querySelector('.curVolume').textContent = vol > 0 ? (vol + ' kg') : '‚Äî';
}

/* ====== Suggestion algorithm (volume-based) ====== */
function recommendIncrementByName(name){
  const lowerKeywords = ['Row','Squat','Dead','Pulldown','Pull','Shrug','T-Bar'];
  const isLower = lowerKeywords.some(k => name.includes(k));
  if(isLower) return {kg:2.5, txt:'+2.5 kg'};
  return {kg:1.25, txt:'+1.25 kg'};
}

function onSuggest(e){
  const exEl = e.target.closest('.ex');
  const exName = decodeURIComponent(exEl.dataset.name);
  const sets = Number(exEl.querySelector('.inputSets').value) || 0;
  const reps = Number(exEl.querySelector('.inputReps').value) || 0;
  const kg = Number(exEl.querySelector('.inputKg').value) || 0;
  const target = Number(exEl.querySelector('.inputTarget').value) || reps;
  const suggestEl = exEl.querySelector('.suggest');
  suggestEl.style.display = 'block';
  suggestEl.innerHTML = '';

  if(kg <= 0){
    suggestEl.innerHTML = '<div>Vui l√≤ng nh·∫≠p <strong>Kg</strong> (ph·∫£i > 0) ƒë·ªÉ nh·∫≠n g·ª£i √Ω.</div>';
    updateVolumeDisplay(exEl);
    return;
  }

  const curVolume = computeVolume(sets, reps, kg);
  updateVolumeDisplay(exEl);

  const list = state[exName] || [];
  const prev = list.length > 0 ? list[list.length - 1] : null;
  const prevVolume = prev ? Number(prev.curVolume) : 0;
  let messages = [];

  if(!prev){
    messages.push(`<div>Ch∆∞a c√≥ b·∫£n ghi tr∆∞·ªõc cho <strong>${exName}</strong>. Baseline hi·ªán t·∫°i: <span class="kv">${curVolume} kg</span>.</div>`);
    if(reps >= target){
      const inc = recommendIncrementByName(exName);
      messages.push(`<div>N·∫øu ƒë√£ ƒë·∫°t target reps (${target}), g·ª£i √Ω: tƒÉng t·∫° ${inc.txt} l·∫ßn t·ªõi v√† ƒë·∫∑t reps v·ªÅ ${Math.max(3,target-2)}-${target} ƒë·ªÉ duy tr√¨ progressive overload.</div>`);
    } else {
      messages.push(`<div>G·ª£i √Ω: ·ªïn ƒë·ªãnh reps theo target trong 2 session, ho·∫∑c tƒÉng volume ~5% b·∫±ng c√°ch +1 rep ho·∫∑c +1 set tr∆∞·ªõc khi tƒÉng t·∫°.</div>`);
    }
    messages.push(`<div>Nh·∫•n <strong>L∆∞u session</strong> ƒë·ªÉ h·ªá th·ªëng l∆∞u baseline v√† so s√°nh ·ªü l·∫ßn sau.</div>`);
    suggestEl.innerHTML = messages.join('');
    return;
  }

  let pct = 0;
  if(prevVolume === 0) pct = 100;
  else pct = ((curVolume - prevVolume) / prevVolume) * 100;
  const pctDisplay = Number(pct.toFixed(2));
  messages.push(`<div>L·∫ßn tr∆∞·ªõc: <strong>${prevVolume} kg</strong> ‚Äî Hi·ªán t·∫°i: <strong>${curVolume} kg</strong>. Œî = <strong>${pctDisplay}%</strong>.</div>`);

  if(pct >= 5){
    messages.push(`<div><strong>Ti·∫øn b·ªô (+${pctDisplay}%).</strong> Volume ƒë√£ tƒÉng ‚â•5% ‚Üí t·ªët. C√≥ th·ªÉ gi·ªØ m·ª©c n√†y ho·∫∑c tƒÉng t·∫° ${recommendIncrementByName(exName).txt} n·∫øu reps ·ªïn ƒë·ªãnh.</div>`);
  } else if(pct > -5 && pct < 5){
    messages.push(`<div><strong>·ªîn ƒë·ªãnh (¬±5%).</strong> ƒê·ªÅ ngh·ªã tƒÉng ~7% volume b·∫±ng c√°ch: 1) +1 rep m·ªói set; 2) ho·∫∑c +1 set; 3) ho·∫∑c +${recommendIncrementByName(exName).txt} (n·∫øu c√≥ micro plates).</div>`);
  } else {
    messages.push(`<div><strong>Gi·∫£m (-${Math.abs(pctDisplay)}%).</strong> Volume gi·∫£m ƒë√°ng k·ªÉ ‚Äî c√≥ th·ªÉ do fatigue/gi·∫•c ng·ªß/ƒÉn u·ªëng. G·ª£i √Ω: ph·ª•c h·ªìi, gi·ªØ ho·∫∑c gi·∫£m nh·∫π t·∫£i, t·∫≠p l·∫°i k·ªπ thu·∫≠t.</div>`);
  }

  if(reps >= target && pct < 5){
    const inc = recommendIncrementByName(exName);
    messages.push(`<div><strong>L∆∞u √Ω:</strong> B·∫°n ƒë·∫°t target reps (${target}) nh∆∞ng volume ch∆∞a tƒÉng ƒë·ªß ‚Äî khuy·∫øn ngh·ªã tƒÉng t·∫° ${inc.txt} l·∫ßn t·ªõi v√† gi·ªØ reps.</div>`);
  }

  suggestEl.innerHTML = messages.map(m=>`<div style="margin-bottom:6px">${m}</div>`).join('');
}

/* ====== Save session (store sets,reps,kg,volume,timestamp) ====== */
function onSaveSession(e){
  const exEl = e.target.closest('.ex');
  const exName = decodeURIComponent(exEl.dataset.name);
  const sets = Number(exEl.querySelector('.inputSets').value) || 0;
  const reps = Number(exEl.querySelector('.inputReps').value) || 0;
  const kg = Number(exEl.querySelector('.inputKg').value) || 0;
  if(kg <= 0){
    Swal.fire({
      icon: 'warning',
      title: 'Thi·∫øu d·ªØ li·ªáu',
      text: 'Vui l√≤ng nh·∫≠p Kg (> 0) tr∆∞·ªõc khi l∆∞u.',
      confirmButtonColor: '#ff7a18'
    });
    return;
  }
  const curVolume = computeVolume(sets, reps, kg);
  const when = new Date().toISOString();
  if(!state[exName]) state[exName] = [];
  state[exName].push({when, sets, reps, kg, curVolume});
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  Swal.fire({
    icon: 'success',
    title: 'ƒê√£ l∆∞u th√†nh c√¥ng!',
    html: `<strong>${exName}</strong><br>Volume: <b>${curVolume} kg</b>`,
    timer: 1500,
    showConfirmButton: false
  });
  updateVolumeDisplay(exEl);
  populateExerciseSelect();
}

/* ====== Calc button ====== */
function onCalcVolume(e){
  const exEl = e.target.closest('.ex');
  updateVolumeDisplay(exEl);
}

/* ====== Populate exercise select ====== */
function populateExerciseSelect(){
  const sel = $('#selectExercise');
  sel.innerHTML = '';
  Object.values(plan).forEach(p => {
    p.ex.forEach(ex => {
      const opt = document.createElement('option');
      opt.value = ex.name;
      opt.textContent = p.name + ' ‚Äî ' + ex.name;
      sel.appendChild(opt);
    });
  });
}

/* ====== Log rendering & chart ====== */
let chart = null;

function renderLog(exName){
  const wrap = $('#logTableWrap');
  const rows = (state[exName] || []).slice().reverse();
  if(rows.length === 0){
    wrap.innerHTML = `<div class="small">Ch∆∞a c√≥ data cho b√†i n√†y. L∆∞u session t·ª´ b√†i t·∫≠p ƒë·ªÉ t·∫°o log.</div>`;
    drawChart(exName, []);
    return;
  }
  let html = `<table><thead><tr><th>Ng√†y</th><th>Sets</th><th>Reps</th><th>Kg</th><th>Volume</th></tr></thead><tbody>`;
  rows.forEach(r=>{
    html += `<tr>
      <td>${(new Date(r.when)).toLocaleString()}</td>
      <td>${r.sets}</td><td>${r.reps}</td><td>${r.kg}</td><td>${r.curVolume}</td>
    </tr>`;
  });
  html += `</tbody></table>`;
  wrap.innerHTML = html;
  drawChart(exName, state[exName] || []);
}

function ensureChartLib(cb){
  if(window.Chart) return cb();
  const s = document.createElement('script');
  s.src = 'https://cdn.jsdelivr.net/npm/chart.js';
  s.onload = cb;
  document.head.appendChild(s);
}

function drawChart(exName, data){
  ensureChartLib(()=>{
    const ctx = document.getElementById('progressChart').getContext('2d');
    const labels = data.map(d => (new Date(d.when)).toLocaleDateString());
    const weights = data.map(d => Number(d.kg));
    const volumes = data.map(d => Number(d.curVolume));
    if(chart) chart.destroy();
    chart = new Chart(ctx, {
      type:'line',
      data:{
        labels,
        datasets:[
          { label: exName + ' ‚Äî Weight (kg)', data: weights, yAxisID:'y', tension:0.15, borderWidth:2, pointRadius:3 },
          { label: exName + ' ‚Äî Volume (kg)', data: volumes, yAxisID:'y1', tension:0.15, borderWidth:2, pointRadius:3 }
        ]
      },
      options:{
        responsive:true,
        interaction:{mode:'index',intersect:false},
        scales:{
          y:{ type:'linear', display:true, position:'left', title:{display:true,text:'Weight (kg)'} },
          y1:{ type:'linear', display:true, position:'right', grid:{drawOnChartArea:false}, title:{display:true,text:'Volume (kg)'} }
        },
        plugins:{ legend:{position:'top'} }
      }
    });
  });
}

/* ====== Menu & controls ====== */
document.getElementById('menuDays').addEventListener('click', function(e){
  if(e.target.tagName === 'BUTTON'){
    $a('#menuDays button').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    const day = e.target.dataset.day;
    renderDay(day);
  }
});

$('#showLog').addEventListener('click', ()=>{
  const ex = $('#selectExercise').value;
  if(!ex) return Swal.fire({icon:'info',title:'Ch∆∞a ch·ªçn b√†i',text:'Vui l√≤ng ch·ªçn b√†i t·∫≠p tr∆∞·ªõc khi xem log.',confirmButtonColor:'#ff7a18'});
  renderLog(ex);
});
$('#clearLog').addEventListener('click', ()=>{
  Swal.fire({
    icon: 'question',
    title: 'X√°c nh·∫≠n x√≥a log?',
    text: 'To√†n b·ªô l·ªãch s·ª≠ s·∫Ω b·ªã x√≥a vƒ©nh vi·ªÖn!',
    showCancelButton: true,
    confirmButtonText: 'X√≥a',
    cancelButtonText: 'H·ªßy',
    confirmButtonColor: '#ff7a18'
  }).then((result)=>{
    if(result.isConfirmed){
      state = {}; localStorage.removeItem(STORAGE_KEY); $('#logTableWrap').innerHTML = '<div class="small">ƒê√£ x√≥a to√†n b·ªô log.</div>'; if(chart){ chart.destroy(); chart = null; }
      Swal.fire({icon:'success',title:'ƒê√£ x√≥a to√†n b·ªô log!',timer:1500,showConfirmButton:false});
    }
  });
});

/* ====== Init ====== */
renderDay(1);
populateExerciseSelect();

</script>
</body>
</html>
